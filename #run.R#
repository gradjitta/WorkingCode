require(snowfall) require(pbapply) require(Rmpi)
getwd()
paths <- readRDS("Data/paths.rds")
initL <- readRDS("Data/inL.rds")
tcounts <- readRDS("Data/tcounts.rds")
lookup <- readRDS("Data/lookup.rds")
sample.run1000 <- readRDS("Data/sample1000.rds")
source("SampleDirichlet.R")
source("alphaInit.R")
source("getTrans.R")
source("getNbGrids.R")
source("getEmit.R")
source("pFFBSIhmm.R")
sfInit(parallel=TRUE, cpus=50, type="SOCK")
sfExport("getTrans", "getEmit", "getNbGrids","SampleDirichlet", "alphaInit")
N <- length(paths)
system.time(sfClusterApplyLB(1:100, pFFBSIhmm, paths, tcounts, initL, sample.run1000, lookup))
sfStop()

system.time(pblapply(1:50, pFFBSIhmm, paths, tcounts, initL, sample.run1000, lookup))

